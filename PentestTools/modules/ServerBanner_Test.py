import argparse
from PentestTools.result import TestResult
import requests

#Name your Check
check_name = "Server Banner"

def parse_args(args):
    parser = argparse.ArgumentParser(description='Check for Server Banner')
    # Standard Parameters (DO NOT MODIFY)
    parser.add_argument('-t', '--target', required=True, help='Target IP address')    
    # Custom Argument (CUSTOMIZE TO YOUR MODULE's NEEDS)
    parser.add_argument('-v', '--verbose', required=False, help='Verbose output, useful for debugging')    
    return parser.parse_args(args)

def run(args):
    parsed_args = parse_args(args)
    
    print(f"Running example module against target: {parsed_args.target}")
    
    try:
        response = requests.get(f"https://{parsed_args.target}")
        if 'Server' in response.headers:
            status = "vulnerable"
            details = {"Server": response.headers['Server']}
        else:
            status = "not vulnerable"
            details = {"Server": "Not found"}
    except requests.RequestException as e:
        status = "fail"
        details = {"error": str(e)}
    
    results = [TestResult(target=parsed_args.target, check=check_name, status=status, details=details)]
    return results
